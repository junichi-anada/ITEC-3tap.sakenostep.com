# サイト削除機能仕様

## 機能の対象
- オペレーター
- 管理者

## 使用テーブル構成
1. **サイト情報**
   - **Siteモデル**（Sitesテーブル）
     - フィールド:
       - `site_code`: ULID形式で一意
       - `company_id`: 会社のID
       - `url`: 有効なURL形式
       - `name`: サイト名
       - `description`: サイトの説明
       - `is_btob`: BtoBフラグ
       - `created_at`: 作成日時
       - `updated_at`: 更新日時
       - `deleted_at`: 削除日時

     - モデルファイル: `Site.php`
     - マイグレーションファイル: `02_create_sites_table.php`
     - ユニークキー: `site_code`, `url`
     - インデックス: `name`, `description`
     - 外部キー: `company_id`

## 実行サービスクラス
- SiteDeleteService

## ビジネスロジック
1. 削除前チェック
   - 対象サイトの存在確認: 指定された`site_code`がSitesテーブルに存在することを確認
   - 削除権限の確認: 操作を行うユーザーが削除権限を持っていることを確認

2. サイト情報の論理削除
   - Sitesテーブルの論理削除: `deleted_at`フィールドを設定して論理削除を行う

3. レスポンス生成
   - 削除成功時:
     - HTTPステータスコード: 204 No Content
     - レスポンス: コンテンツなし
   - エラー発生時は適切なステータスコードとメッセージを返却

## エラーハンドリング
- 成功:
  - サイト情報が正常に削除された場合
    - HTTPステータスコード: 204 No Content
    - レスポンス: なし
- 失敗:
  - サイト不在エラー
    - HTTPステータスコード: 404 Not Found
    - エラーメッセージ: "指定されたサイトが見つかりません"
  - 権限エラー
    - HTTPステータスコード: 403 Forbidden
    - エラーメッセージ: "この操作を実行する権限がありません"
  - データベースエラー
    - HTTPステータスコード: 500 Internal Server Error
    - エラーメッセージ: "サイト情報の削除に失敗しました。システム管理者に連絡してください"
    - ログ出力: エラー詳細（SQL, パラメータ, エラーメッセージ）

## テストケース
1. 正常系
   - 存在するサイトを削除
     - 期待結果: 204 No Content

2. 異常系
   - サイト不在エラー
     - 存在しないsite_codeを指定
       - 期待結果: 404 Not Found、エラーメッセージ: "指定されたサイトが見つかりません"
   - 認証エラー
     - 権限のないユーザーが削除を試みる
       - 期待結果: 403 Forbidden、エラーメッセージ: "この操作を実行する権限がありません" 
