# 3TAP受発注システム開発　要件定義

## 1. 概要
このシステムは、ブラウザ上で動作するクラウド型の受発注システムです。BtoBビジネスやBtoCビジネスの受発注業務を効率的に行うことを目指しています。
具体的には、このシステムは以下の目的を持っています。まず、受発注業務における課題を解決し、スムーズな受発注プロセスを実現します。これにより、ビジネスパートナーや顧客との関係性を強化し、業務効率を向上させることができます。
さらに、このシステムはBtoBビジネスだけでなく、BtoCビジネスにも対応しています。つまり、企業間の取引だけでなく、個人との取引も円滑に行うことができます。

## 2. 目的
このシステムは、ブラウザ上で動作するクラウド型の受発注システムであり、BtoBビジネスやBtoCビジネスの受発注業務を効率的に行うことを目的としています。
具体的には、受発注業務における課題を解決し、スムーズな受発注プロセスを実現することで、ビジネスパートナーや顧客との関係性を強化し、業務効率を向上させることができます。さらに、BtoBビジネスだけでなく、BtoCビジネスにも対応しており、企業間の取引だけでなく、個人との取引も円滑に行うことができます。
このシステムは、受発注業務におけるニーズや要件を満たすために開発されており、利用者にとって使いやすいインターフェースや高いセキュリティレベルも提供します。さらに、パフォーマンス要件やその他の要件も適切に満たすことで、効果的な受発注プロセスの実現を支援します。
このシステムの導入により、ビジネスパートナーや顧客との関係性が強化され、業務効率が向上することが期待されます。また、受発注業務の効率化により、企業の競争力が向上し、成長を促すことも可能です。

## 3. システムの範囲
このシステムは、ブラウザ上で動作し、受発注業務を効率的に行うことを目的としています。具体的には、以下の機能やサービスを提供します。
- 顧客が商品の注文を行う機能
- オペレータが注文を受け取り、受注情報を確認し、商品の準備や配送手配を行う機能
- 管理者がシステム全体の運営や管理、セキュリティの監視などを行う機能

これにより、ビジネスパートナーや顧客との関係性を強化し、業務効率を向上させることができます。また、BtoBビジネスだけでなく、BtoCビジネスにも対応しており、企業間の取引だけでなく、個人との取引も円滑に行うことができます。
利用者の期待や制約事項については、顧客は注文内容や配送先などの詳細情報を入力し、オペレータに伝えます。オペレータは顧客とコミュニケーションを取りながら受注プロセスを効率的に行います。管理者はシステム全体の管理やセキュリティの監視を行い、システムの安定稼働や問題の解決に貢献します。

## 4. ユーザーキャラクター
1. 顧客：システムを使って注文を出す人。主に飲食店や小売店などの事業者、一般ユーザーが該当します。彼らはシステムを活用して製品や商品の注文を行います。注文内容や配送先などの詳細情報を入力し、オペレータに伝えます。
2. オペレータ：システムを使って注文を受ける人。主に卸売業者やメーカーなどの事業者の受注担当者が該当します。彼らは顧客からの注文を受け取り、受注情報を確認し、製品や商品の準備や配送手配を行います。オペレータはシステムを通じて顧客とコミュニケーションを取りながら、効率的な受注プロセスを実現します。
3. 運営会社: システムを運営する会社。主に卸売業者やメーカーなどの事業者が該当します。彼らはシステム上でオペレータ情報を管理する役割をもつ。
4. 管理者：システムの全体管理者。彼らはシステム全体の運営や管理、セキュリティの監視、ユーザーアカウントの管理などを担当します。管理者はシステムの安定稼働や問題の解決、新機能の導入など、システムの継続的な改善に貢献します。彼らは顧客やオペレータとは異なる立場でシステムを利用し、システム全体の管理に関わります。

このように、要件定義におけるユーザーキャラクターの項目は、顧客、オペレータ、運営会社、管理者の4つに分けられます。それぞれの役割や立場に応じて、システムを活用して受発注プロセスを円滑に行うことが求められます。

## 5. 機能要件

この受発注システムは、以下の機能要件を満たすことが求められますが、すべての機能をスタート時には基本機能の実装を行い、必要な機能を順次実装します。

### 5-1. 基本機能
1. ログイン機能
  - システムの全ての利用者にそれぞれに適したログイン機能を提供します。
  - 顧客はログイン認証（ID・パスワード方式）のみではなく、LINEなどの各プラットフォームを利用したoAuth認証が利用できるようにします。
  - オペレータ、運営会社、管理者はログイン認証を利用できるようにします。
2. ログアウト機能
  - システムを利用する全ての利用者に安全なログアウト機能を提供します。
  - 具体的には、ユーザーの操作によるログアウト機能と、規定時間経過によるセッション破棄によるログアウト機能を提供します。
  - ユーザーごとのアクセス権限を設定し、適切な情報へのアクセスを制限します。管理者は全ての機能とデータにアクセスできる権限を持ち、顧客とオペレータはそれぞれの役割に応じた機能とデータにアクセスできる権限を持ちます。
3. オペレータによる顧客管理機能
  - オペレータがシステムで用意された画面から顧客のデータを管理（作成、表示、更新、削除）する機能を提供します。
4. オペレータによる顧客データインポート機能
  - オペレータはCSVファイルをアップロードすることで、顧客のデータをインポートできるようにします。
  - インポートするCSVファイルのフォーマットは、運営会社が作成するサイトごとに任意に定義できるようにします。
5. ID・パスワードによるユーザー登録機能
  - 顧客によるID・パスワードによるユーザー登録機能を提供します。
  - 顧客は、ID・パスワード方式のログイン認証を選択した場合は、任意のIDとパスワードを決定することができます。
  - ユーザーは個別のアカウントを作成し、システムにアクセスするための認証を行います。これにより、システムには認証されたユーザーのみがアクセスできるようになります。
6. oAuth認証によるユーザー登録機能
  - 顧客は、oAuth認証を選択した場合は、各プラットフォームが定める方法で、本システムにユーザー情報を送信することにより、ユーザー登録が行われます。
  - oAuth認証によるユーザー登録機能をサイトに付加するかどうかは、運営会社がサイトごとに任意に選択できるようにします。
  - スタート時点では、LINEのoAuth認証を利用できるようにします。
7. 受注機能:
  - 顧客が製品や商品の注文を行えるようにします。顧客はシステムを介して製品や商品を選択し、数量や配送先などの注文情報を入力します。
  - 発注内容や配送先情報などを入力できるフォームを提供します。フォームは使いやすく直感的な操作ができるように設計されており、顧客は簡単に必要な情報を入力できます。
  - 顧客に注文確認の通知を送信し、オペレータに受注情報を表示します。顧客は注文内容を確認し、オペレータは受注情報を確認して注文の受け取りと処理を開始できます。
8. オペレータによる顧客へのLINEメッセージ送信機能
  - オペレータが顧客への注文確認の通知を送信できるようにします。
9. 注文管理機能
  - オペレータが注文データを管理（作成、表示、更新、削除）する機能を提供します。
8. 注文データエクスポート機能
  - オペレータは注文データをCSVファイルとしてエクスポートできるようにします。
  - エクスポートするCSVファイルのフォーマットは、運営会社が作成するサイトごとに任意に定義できるようにします。
9. 商品検索機能:
  - 顧客は商品を検索できるようにします。
  - 商品はカテゴリーごとに検索できるようにします。
  - 商品はキーワードで検索できるようにします。
10. 商品管理機能:
  - 商品や製品の在庫数を管理します。システムは在庫数を監視し、在庫が一定数以下になった場合には自動的に補充の依頼を行います。これにより、在庫切れによる注文の遅延や顧客の不満を防ぐことができます。
11. 商品データインポート機能
  - オペレータはCSVファイルをアップロードすることで、商品のデータをインポートできるようにします。
  - インポートするCSVファイルのフォーマットは、運営会社が作成するサイトごとに任意に定義できるようにします。
12. おすすめ商品管理機能
  - オペレータがおすすめ商品を管理する機能を提供します。
  - おすすめ商品は、サイトごとに任意に定義できるようにします。
  - おすすめ商品に選択された商品は、顧客の画面に表示されるようにします。
13. お気に入り商品管理機能
  - 顧客がお気に入り商品を管理する機能を提供します。
  - お気に入り商品は、顧客ごと、サイトごとに任意に定義できるようにします。
  - お気に入り商品に選択された商品は、顧客の画面に表示されるようにします。

### 5-2. 追加機能
1. 運営会社による登録方法選別機能
  - 運営会社は、サイトごとにID・パスワードによるユーザー登録機能を利用するか、oAuth認証によるユーザー登録機能を利用するかを選択できるようにします。
2. 請求機能:
  - 発注の請求書を作成し、顧客に送信します。請求書には注文内容や金額、支払い期限などが記載されており、顧客はこれを確認して支払いを行います。
  - 請求書の支払い状況を管理し、未払いの場合には催促の通知を顧客に送信します。これにより、請求書の支払い漏れを防ぎ、正確な売上管理を行うことができます。
3. 配送管理機能:
  - オペレータが注文を受け取り、配送手配を行えるようにします。オペレータは受注情報を確認し、必要な手続きや準備を行います。
  - 配送状況を追跡し、顧客に配送の進捗状況を通知します。顧客は注文の進捗を把握し、顧客への配送予定を確認することができます。
4. レポート機能:
  - 受発注データや売上データなどのレポートを作成し、管理者に提供します。これにより、ビジネスの状況やトレンドを把握し、意思決定や戦略立案に役立てることができます。
  - データの集計や分析機能を提供し、ビジネスの可視化を支援します。グラフやチャートなどの視覚化ツールを活用し、データをわかりやすく表現します。
5. サポート機能:
  - 利用者からの問い合わせやサポートリクエストに対応する仕組みを提供します。ユーザーはオンラインチャットやメールなどのコミュニケーションツールを利用して問題や疑問を報告し、サポートを受けることができます。
  - サポート担当者は報告された問題に迅速に対応し、解決策やアドバイスを提供します。これにより、利用者の問題解決や満足度向上に貢献します。
6. 運営会社管理機能
  - 管理者が運営会社のデータを管理（作成、表示、更新、削除）する機能を提供します。
7. マルチサイト機能
  - 運営会社はサイトごとにデータを管理できるようにします。
8. オペレータ管理機能
  - 管理者がオペレータのデータを管理（作成、表示、更新、削除）する機能を提供します。


これらの機能要件を満たすことで、効率的な受発注プロセスを実現し、ビジネスパートナーや顧客との関係性を強化することができます。

## 6. パフォーマンス要件
パフォーマンス要件は、システムが必要とする性能や動作条件に関する要件を指定します。以下のパフォーマンス要件を満たすことが期待されます。
- システムのレスポンスは可能な限り早くする必要があります。ユーザーが操作を行ってからシステムが応答するまでの時間を最小限に抑えることが求められます。
- システムは1週間に1回定期的なバックアップを行う仕組みを導入する必要があります。データの損失やシステムの障害が発生した場合でも、最新のデータを復元できるようにすることが重要です。
- システムは同時接続1000人に耐える性能を持つ必要があります。多くのユーザーが同時にシステムにアクセスしても、応答性や処理能力が低下しないようにすることが求められます。
これらのパフォーマンス要件を満たすことで、ユーザーはスムーズな操作や高速なレスポンスを体感できるだけでなく、システムの安定稼働やデータの保護が実現されます。

## 7. 実装要件

# バックエンド
- バックエンドは、フロントエンドからのリクエストを受け付け、データベースの操作やAPIの提供を行います。
- バックエンドのAPIは、JSON形式でフロントエンドに返します。
- AJAX通信を行う場合は、web.phpで期待するルートがあるか確認します。
- 使うルートはWebルートです。APIルートは使用しません。

# フロントエンド
- フロントエンドのUIはBladeテンプレート＋tailwindCSSで作成します
- 表示処理は通常のWebページのように振る舞います。
- データ操作が必要（登録・更新・削除）の場合は、AJAX通信でバックエンドにリクエストを行います。
- APIのデータは、フロントエンドではJSON形式で受け取ります。

# テストデータ作成
1. サイト情報(Sitesテーブル)をテストデータとして作成する場合には、会社情報(Companiesテーブル)のデータが必要です。

# データ操作
- データ操作を行う場合は、必ずトランザクション管理を行う。
- データ操作の際には、ログ出力を行う。

## 8. セキュリティ要件

### 8-1. 認証・認可要件

#### 顧客向け認証
- 認証方式
  - ログインID + 電話番号による認証
  - LINE OAuth認証（オプション）
- パスワード（電話番号）要件
  - 電話番号形式のバリデーション実施
  - データベースへの保存時はハッシュ化必須
  - ハッシュアルゴリズム：bcrypt を使用

#### 管理者・オペレータ・運営会社向け認証
- パスワードポリシー
  - 最小8文字以上
  - 英大文字、英小文字、数字を含む
  - 有効期限：90日
- アカウントロック
  - 5回連続ログイン失敗でロック
  - ロック解除は管理者による手動解除のみ

### 8-2. セッション管理
- セッションタイムアウト：8時間
- セッションID
  - HTTPSのみで送信
  - セッションIDの自動再生成
- 同時ログイン：禁止

### 8-3. データセキュリティ
- 個人情報の暗号化
  - 電話番号：ハッシュ化
- データベースアクセス
  - 最小権限の原則に基づくアクセス制御
  - クエリパラメータのバインド処理必須

### 8-4. 通信セキュリティ
- HTTPS必須（TLS 1.2以上）
- HTTP通信の自動HTTPS転送
- CSRFトークンによる保護
- XSS対策
  - 入力値のエスケープ処理
  - Content-Security-Policyの適用

### 8-5. アクセスログ
- 記録する操作
  - ログイン／ログアウト
  - 個人情報へのアクセス
  - データの作成・更新・削除
- ログの保持期間：1年間
- ログ項目
  - 操作日時
  - 操作者ID
  - 操作内容
  - IPアドレス
  - ユーザーエージェント
